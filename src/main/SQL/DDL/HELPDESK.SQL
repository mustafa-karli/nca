CREATE TABLE SERVICE_LEVEL_AGREEMENT (
  OWNER_ID             INTEGER       NOT NULL,
  BUSINESS_SERVICE_ID  VARCHAR(20)   NOT NULL,
  BUSINESS_PARTNER_ID  INTEGER       NOT NULL,
  BEGDA                TIMESTAMP     NOT NULL,
  ENDDA                TIMESTAMP,
  INITIAL_RESPONSE     INTEGER,
  EXPERT_RESPONSE      INTEGER,
  SERVICE_DAYS         CHAR(1),
  SERVICE_HOURS        CHAR(1),
    CONSTRAINT SERVICE_LEVEL_AGREEMENT_PK PRIMARY KEY (OWNER_ID, BUSINESS_SERVICE_ID, BUSINESS_PARTNER_ID, BEGDA),
    CONSTRAINT PARTNER_SERVICE_AGREEMENTS FOREIGN KEY (BUSINESS_SERVICE_ID) REFERENCES BUSINESS_SERVICE (BUSINESS_SERVICE_ID),
    CONSTRAINT SERVICE_LEVEL_AGREEMENTS   FOREIGN KEY (BUSINESS_PARTNER_ID) REFERENCES BUSINESS_PARTNER (BUSINESS_PARTNER_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE INDEX SERVICE_LEVEL_AGREEMENT_IND1 ON SERVICE_LEVEL_AGREEMENT (BUSINESS_SERVICE_ID);
CREATE INDEX SERVICE_LEVEL_AGREEMENT_IND2 ON SERVICE_LEVEL_AGREEMENT (BUSINESS_PARTNER_ID);



CREATE TABLE SUPPORT_AREA (
  SUPPORT_AREA_ID      INTEGER       NOT NULL,
  OWNER_ID             INTEGER       NOT NULL,
  BUSINESS_SERVICE_ID  VARCHAR(20)   NOT NULL,
  CAPTION              VARCHAR(80)   NOT NULL,
    CONSTRAINT SUPPORT_AREA_PK PRIMARY KEY (SUPPORT_AREA_ID),
    CONSTRAINT SUPPORT_AREAS   FOREIGN KEY (BUSINESS_SERVICE_ID) REFERENCES BUSINESS_SERVICE (BUSINESS_SERVICE_ID)
);

CREATE INDEX SUPPORT_AREA_IND1 ON SUPPORT_AREA (OWNER_ID);
CREATE INDEX SUPPORT_AREA_IND2 ON SUPPORT_AREA (BUSINESS_SERVICE_ID);



CREATE TABLE SUPPORT_GROUP (
  SUPPORT_GROUP_ID     INTEGER       NOT NULL,
  OWNER_ID             INTEGER       NOT NULL,
  CAPTION              VARCHAR(80)   NOT NULL,
    CONSTRAINT SUPPORT_GROUP_PK PRIMARY KEY (SUPPORT_GROUP_ID)
);

CREATE INDEX SUPPORT_GROUP_IND1 ON SUPPORT_GROUP (OWNER_ID);



CREATE TABLE SUPPORT_AGENT (
  SUPPORT_GROUP_ID     INTEGER       NOT NULL,
  USERNAME             VARCHAR(30)   NOT NULL,
  BEGDA                TIMESTAMP     NOT NULL,
  ENDDA                TIMESTAMP,
  SERVICE_DAYS         CHAR(1),
  SERVICE_HOURS        CHAR(1),
  WORK_SHIFT           CHAR(1),
    CONSTRAINT SUPPORT_AGENT_PK PRIMARY KEY (SUPPORT_GROUP_ID, USERNAME, BEGDA),
    CONSTRAINT SUPPORT_AGENTS   FOREIGN KEY (SUPPORT_GROUP_ID) REFERENCES SUPPORT_GROUP (SUPPORT_GROUP_ID) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT AGENT_GROUPS     FOREIGN KEY(USERNAME) REFERENCES USER_ACCOUNT(USERNAME)
);

CREATE INDEX SUPPORT_AGENT_IND1 ON SUPPORT_AGENT (USERNAME);



CREATE TABLE SUPPORT_TICKET (
  TICKET_ID            INTEGER       NOT NULL,
  ASSET_NAME           VARCHAR(80)   NOT NULL,
  USERNAME             VARCHAR(30)   NOT NULL,
  SUPPORT_AREA_ID      INTEGER       NOT NULL,
  SUPPORT_GROUP_ID     INTEGER,
  SUPPORT_USER         VARCHAR(30),
  ISSUE_DATE           TIMESTAMP     NOT NULL,
  PRIORITY             CHAR(1)       NOT NULL,
  TICKET_TYPE          CHAR(1)       NOT NULL,
  STATUS               CHAR(1)       NOT NULL,
  CAPTION              VARCHAR(80)   NOT NULL,
    CONSTRAINT SUPPORT_TICKET_PK     PRIMARY KEY (TICKET_ID) ,
    CONSTRAINT SUPPORT_AREA_TICKETS  FOREIGN KEY (SUPPORT_AREA_ID)  REFERENCES SUPPORT_AREA (SUPPORT_AREA_ID),
    CONSTRAINT SUPPORT_GROUP_TICKETS FOREIGN KEY (SUPPORT_GROUP_ID) REFERENCES SUPPORT_GROUP (SUPPORT_GROUP_ID),
    CONSTRAINT USER_ACCOUNT_TICKETS  FOREIGN KEY (USERNAME)         REFERENCES USER_ACCOUNT (USERNAME),
    CONSTRAINT SUPPORT_USER_TICKETS  FOREIGN KEY (SUPPORT_USER)     REFERENCES USER_ACCOUNT (USERNAME)
);

CREATE INDEX SUPPORT_TICKET_IND1 ON SUPPORT_TICKET (SUPPORT_AREA_ID);
CREATE INDEX SUPPORT_TICKET_IND2 ON SUPPORT_TICKET (USERNAME);
CREATE INDEX SUPPORT_TICKET_IND3 ON SUPPORT_TICKET (SUPPORT_GROUP_ID);
CREATE INDEX SUPPORT_TICKET_IND4 ON SUPPORT_TICKET (SUPPORT_USER);



CREATE TABLE TICKET_EVENT (
  TICKET_ID            INTEGER   NOT NULL,
  EVENT_DATE           TIMESTAMP   NOT NULL,
  USERNAME             VARCHAR(30)   NOT NULL,
  OLD_STATUS           INTEGER   NOT NULL,
  NEW_STATUS           INTEGER   NOT NULL,
  TEXT_TYPE            INTEGER,
  DESCRIPTION          VARCHAR(2000),
    CONSTRAINT TICKET_EVENT_PK       PRIMARY KEY (TICKET_ID, EVENT_DATE),
    CONSTRAINT SUPPORT_TICKET_EVENTS FOREIGN KEY (TICKET_ID) REFERENCES SUPPORT_TICKET (TICKET_ID) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT USER_TICKET_EVENTS    FOREIGN KEY (USERNAME)  REFERENCES USER_ACCOUNT (USERNAME)
);

CREATE INDEX TICKET_EVENT_IND1 ON TICKET_EVENT (USERNAME);
