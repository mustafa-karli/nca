CREATE TABLE MANUFACTURER (
  MANUFACTURER_ID      VARCHAR(30)   NOT NULL,
  CAPTION              VARCHAR(80)   NOT NULL,
    CONSTRAINT MANUFACTURER_PK PRIMARY KEY (MANUFACTURER_ID)
);



CREATE TABLE MATERIAL_TYPE (
  MATERIAL_TYPE_ID     VARCHAR(30)   NOT NULL,
  CAPTION              VARCHAR(80)   NOT NULL,
  UNIT                 VARCHAR(3)    NOT NULL,
  MASTER               INTEGER,
  LOGO                 VARCHAR(80),
    CONSTRAINT MATERIAL_TYPE_PK PRIMARY KEY (MATERIAL_TYPE_ID)
);



CREATE TABLE MATERIAL_ATTRIBUTE_GROUP (
  MAG_ID               VARCHAR(8)   NOT NULL,
  OWNER_ID             INTEGER      NOT NULL,
  CAPTION              VARCHAR(30)  NOT NULL,
    CONSTRAINT MATERIAL_ATTRIBUTE_GROUP_PK PRIMARY KEY (MAG_ID)
);

CREATE INDEX MATERIAL_ATTRIBUTE_GROUP_IND1 ON MATERIAL_ATTRIBUTE_GROUP (OWNER_ID);



CREATE TABLE MATERIAL_ATTRIBUTE_OPTION (
  MAG_ID               VARCHAR(8)   NOT NULL,
  LOW                  VARCHAR(8)   NOT NULL,
  HIGH                 VARCHAR(8),
  CAPTION              VARCHAR(30)   NOT NULL,
    CONSTRAINT MATERIAL_ATTRIBUTE_OPTION_PK PRIMARY KEY (MAG_ID, LOW),
    CONSTRAINT MATERIAL_ATTRIBUTE_OPTIONS FOREIGN KEY (MAG_ID) REFERENCES MATERIAL_ATTRIBUTE_GROUP (MAG_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE INDEX MATERIAL_ATTRIBUTE_OPTION_IND1 ON MATERIAL_ATTRIBUTE_OPTION (MAG_ID);



CREATE TABLE MATERIAL_TYPE_ATTRIBUTE (
  MATERIAL_TYPE_ID     VARCHAR(30)   NOT NULL,
  MAG_ID               VARCHAR(8)    NOT NULL,
  MANDATORY            CHAR(1)       NOT NULL,
  DEFAULT_VALUE        VARCHAR(8),
    CONSTRAINT MATERIAL_TYPE_ATTRIBUTE_PK     PRIMARY KEY(MATERIAL_TYPE_ID, MAG_ID),
    CONSTRAINT MATERIAL_TYPE_ATTRIBUTES       FOREIGN KEY(MATERIAL_TYPE_ID) REFERENCES MATERIAL_TYPE (MATERIAL_TYPE_ID) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT ATTRIBUTE_GROUP_MATERIAL_TYPES FOREIGN KEY(MAG_ID)           REFERENCES MATERIAL_ATTRIBUTE_GROUP (MAG_ID)
);

CREATE INDEX MATERIAL_TYPE_ATTRIBUTE_IND1 ON MATERIAL_TYPE_ATTRIBUTE (MAG_ID);



CREATE TABLE MATERIAL_GROUP (
  MATERIAL_GROUP_ID    INTEGER       NOT NULL,
  OWNER_ID             INTEGER       NOT NULL,
  CAPTION              VARCHAR(80)   NOT NULL,
  PURPOSE              VARCHAR(20)   NOT NULL,
  PARENT_ID            INTEGER,
    CONSTRAINT MATERIAL_GROUP_PK PRIMARY KEY(MATERIAL_GROUP_ID),
    CONSTRAINT MATERIAL_GROUPS   FOREIGN KEY(PARENT_ID) REFERENCES MATERIAL_GROUP(MATERIAL_GROUP_ID)
);

CREATE INDEX MATERIAL_GROUP_IND1 ON MATERIAL_GROUP (PARENT_ID);
CREATE INDEX MATERIAL_GROUP_IND2 ON MATERIAL_GROUP (OWNER_ID);



CREATE TABLE MATERIAL (
  MATERIAL_ID          INTEGER       NOT NULL,
  OWNER_ID             INTEGER       NOT NULL,
  MATERIAL_TYPE_ID     VARCHAR(30)   NOT NULL,
  MANUFACTURER_ID      VARCHAR(30),
  CAPTION              VARCHAR(80)   NOT NULL,
  DEFAULT_UNIT         VARCHAR(3)    NOT NULL,
  PURCHASE_UNIT        VARCHAR(8),
  ISSUE_TYPE           CHAR(1),
  ISSUE_UNIT           VARCHAR(8),
  SHELF_LIFE           SMALLINT,
  COST_METHOD          VARCHAR(8),
  COST                 DECIMAL(10,2),
  EQUIPMENT            CHAR(1),
  PART_NUMBER          VARCHAR(30),
  STATUS               CHAR(1),
    CONSTRAINT MATERIAL_PK            PRIMARY KEY (MATERIAL_ID),
    CONSTRAINT MANUFACTURED_MATERIALS FOREIGN KEY (MANUFACTURER_ID) REFERENCES MANUFACTURER (MANUFACTURER_ID),
    CONSTRAINT MATERIALS              FOREIGN KEY (MATERIAL_TYPE_ID) REFERENCES MATERIAL_TYPE (MATERIAL_TYPE_ID)
);

CREATE INDEX MATERIAL_IND1 ON MATERIAL (MANUFACTURER_ID);
CREATE INDEX MATERIAL_IND2 ON MATERIAL (OWNER_ID);
CREATE INDEX MATERIAL_IND3 ON MATERIAL (MATERIAL_TYPE_ID);



CREATE TABLE MATERIAL_ATTRIBUTE (
  MATERIAL_ID          INTEGER      NOT NULL,
  MAG_ID               VARCHAR(8)   NOT NULL,
  VALUE                VARCHAR(8)   NOT NULL,
    CONSTRAINT MATERIAL_ATTRIBUTE_PK     PRIMARY KEY (MATERIAL_ID, MAG_ID),
    CONSTRAINT MATERIAL_ATTRIBUTES       FOREIGN KEY (MATERIAL_ID) REFERENCES MATERIAL (MATERIAL_ID) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT ATTRIBUTE_GROUP_MATERIALS FOREIGN KEY (MAG_ID)      REFERENCES MATERIAL_ATTRIBUTE_GROUP (MAG_ID)
);

CREATE INDEX MATERIAL_ATTRIBUTE_IND3 ON MATERIAL_ATTRIBUTE (MAG_ID, VALUE);



CREATE TABLE MATERIAL_GROUP_ASSIGNMENT (
  MATERIAL_GROUP_ID    INTEGER     NOT NULL,
  MATERIAL_ID          INTEGER     NOT NULL,
  BEGDA                TIMESTAMP   NOT NULL,
    CONSTRAINT MATERIAL_GROUP_ASSIGNMENT_PK PRIMARY KEY(MATERIAL_GROUP_ID, MATERIAL_ID),
    CONSTRAINT GROUP_MATERIAL_ASSIGNMENTS   FOREIGN KEY(MATERIAL_GROUP_ID) REFERENCES MATERIAL_GROUP (MATERIAL_GROUP_ID) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT MATERIAL_GROUP_ASSIGNMENTS   FOREIGN KEY(MATERIAL_ID)       REFERENCES MATERIAL (MATERIAL_ID)
);

CREATE INDEX MATERIAL_GROUP_ASSIGNMENT_IND1 ON MATERIAL_GROUP_ASSIGNMENT (MATERIAL_ID);



CREATE TABLE MATERIAL_INVENTORY (
  ORGANIZATION_ID      INTEGER         NOT NULL,
  MATERIAL_ID          INTEGER         NOT NULL,
  QUANTITY             DECIMAL(10,2)   NOT NULL,
  UNIT                 VARCHAR(3)      NOT NULL,
  RESERVED             DECIMAL(10,2),
  RESERVE_UNIT         VARCHAR(3),
  COST                 DECIMAL(10,2),
    CONSTRAINT MATERIAL_INVENTORY_PK     PRIMARY KEY (ORGANIZATION_ID, MATERIAL_ID),
    CONSTRAINT MATERIAL_INVENTORIES      FOREIGN KEY (MATERIAL_ID)     REFERENCES MATERIAL (MATERIAL_ID),
    CONSTRAINT ORGANIZATIONS_INVENTORIES FOREIGN KEY (ORGANIZATION_ID) REFERENCES ORGANIZATION (ORGANIZATION_ID)
);

CREATE INDEX MATERIAL_INVENTORY_IND1 ON MATERIAL_INVENTORY (ORGANIZATION_ID);



CREATE TABLE LOT_INVENTORY (
  ORGANIZATION_ID      INTEGER         NOT NULL,
  MATERIAL_ID          INTEGER         NOT NULL,
  LOT_ID               VARCHAR(10)     NOT NULL,
  QUANTITY             DECIMAL(10,2)   NOT NULL,
  BEGDA                TIMESTAMP       NOT NULL,
    CONSTRAINT LOT_INVENTORY_PK PRIMARY KEY (ORGANIZATION_ID, MATERIAL_ID, LOT_ID),
    CONSTRAINT LOT_INVENTORIES  FOREIGN KEY (ORGANIZATION_ID, MATERIAL_ID) REFERENCES MATERIAL_INVENTORY (ORGANIZATION_ID, MATERIAL_ID)
);



CREATE TABLE MATERIAL_INVENTORY_HISTORY (
  ORGANIZATION_ID      INTEGER     NOT NULL,
  MATERIAL_ID          INTEGER     NOT NULL,
  PERIOD_END           TIMESTAMP   NOT NULL,
  YEAR                 SMALLINT,
  QUARTER              SMALLINT,
  MONTH                SMALLINT,
  WEEK                 SMALLINT,
    CONSTRAINT MATERIAL_INVENTORY_HISTORY_PK PRIMARY KEY (ORGANIZATION_ID, MATERIAL_ID, PERIOD_END),
    CONSTRAINT MATERIAL_INVENTORY_HISTORIES  FOREIGN KEY (MATERIAL_ID)     REFERENCES MATERIAL (MATERIAL_ID),
    CONSTRAINT ORGANIZATION_INVNT_HISTORIES  FOREIGN KEY (ORGANIZATION_ID) REFERENCES ORGANIZATION (ORGANIZATION_ID)
);

CREATE INDEX MATERIAL_INVENTORY_HISTORY_IND1 ON MATERIAL_INVENTORY_HISTORY (MATERIAL_ID);



CREATE TABLE MATERIAL_MOVEMENT (
  MM_TX_ID             BIGINT          NOT NULL,
  MATERIAL_ID          INTEGER         NOT NULL,
  MOVE_TYPE            SMALLINT        NOT NULL,
  BEGDA                TIMESTAMP       NOT NULL,
  QUANTITY             DECIMAL(10,2)   NOT NULL,
  UNIT                 VARCHAR(3)      NOT NULL,
  USERNAME             VARCHAR(30)     NOT NULL,
  ORDER_TYPE           CHAR(1),
  ORDER_ID             INTEGER,
  REVERSED             CHAR(1),
  REVERS_TX_ID         INTEGER,
  FROM_TYPE            CHAR(1),
  FROM_ID              INTEGER,
  TO_TYPE              CHAR(1),
  TO_ID                INTEGER,
    CONSTRAINT MATERIAL_MOVEMENT_PK PRIMARY KEY (MM_TX_ID),
    CONSTRAINT MATERIAL_MOVEMENTS   FOREIGN KEY (MATERIAL_ID) REFERENCES MATERIAL (MATERIAL_ID)
);

CREATE INDEX MATERIAL_MOVEMENT_IND1 ON MATERIAL_MOVEMENT (MATERIAL_ID);



CREATE TABLE MATERIAL_PACK_UNIT (
  MATERIAL_ID          INTEGER         NOT NULL,
  PACK                 VARCHAR(8)      NOT NULL,
  QUANTITY             DECIMAL(10,2)   NOT NULL,
  UNIT                 VARCHAR(3)      NOT NULL,
    CONSTRAINT MATERIAL_PACK_UNIT_PK PRIMARY KEY (MATERIAL_ID, PACK),
    CONSTRAINT MATERIAL_PACK_UNITS   FOREIGN KEY (MATERIAL_ID) REFERENCES MATERIAL (MATERIAL_ID) ON DELETE CASCADE ON UPDATE CASCADE
);



CREATE TABLE MATERIAL_RESERVATION (
  RESERVATION_ID       INTEGER         NOT NULL,
  MATERIAL_ID          INTEGER         NOT NULL,
  BEGDA                TIMESTAMP       NOT NULL,
  STATUS               CHAR(1)         NOT NULL,
  QUANTITY             DECIMAL(10,2)   NOT NULL,
  UNIT                 VARCHAR(3)      NOT NULL,
  ORDER_TYPE           CHAR(1)         NOT NULL,
  ORDER_ID             INTEGER         NOT NULL,
    CONSTRAINT MATERIAL_RESERVATION_PK PRIMARY KEY (RESERVATION_ID),
    CONSTRAINT MATERIAL_RESERVATIONS FOREIGN KEY (MATERIAL_ID) REFERENCES MATERIAL (MATERIAL_ID)
);

CREATE INDEX MATERIAL_RESERVATION_IND1 ON MATERIAL_RESERVATION (MATERIAL_ID);
