CREATE TABLE TAX_TYPE (
  TAX_ID               VARCHAR(8)     NOT NULL,
  CAPTION              VARCHAR(30)    NOT NULL,
  COUNTRY              VARCHAR(2)     NOT NULL,
  RATE                 DECIMAL(8,2)   NOT NULL,
    CONSTRAINT TAX_TYPE_PK PRIMARY KEY (TAX_ID)
);



CREATE TABLE BANK (
  BANK_ID              CHAR(8)       NOT NULL,
  COUNTRY              CHAR(2)       NOT NULL,
  CAPTION              VARCHAR(80)   NOT NULL,
  ROUTING              VARCHAR(20),
    CONSTRAINT BANK_PK PRIMARY KEY (BANK_ID)
);



CREATE TABLE EXCHANGE_RATE (
  CDATE                TIMESTAMP     NOT NULL,
  CURR1                CHAR(3)       NOT NULL,
  CURR2                CHAR(3)       NOT NULL,
  RATE                 DECIMAL(8,4)  NOT NULL,
    CONSTRAINT EXCHANGE_RATE_PK PRIMARY KEY (CDATE, CURR1, CURR2)
);



CREATE TABLE BANK_BRANCH (
  SWIFT                VARCHAR(11)   NOT NULL,
  BANK_ID              CHAR(8)       NOT NULL,
  BRANCH_CODE          SMALLINT      NOT NULL,
  LATITUDE             DECIMAL(25,10),
  LONGITUDE            DECIMAL(25,10),
  ALTITUDE             DECIMAL(25,20),
  STATE                CHAR(2),
  CITY                 VARCHAR(40),
  ADDRESS              VARCHAR(80),
    CONSTRAINT BANK_BRANCH_PK PRIMARY KEY (SWIFT),
    CONSTRAINT BANK_BRANCHES FOREIGN KEY (BANK_ID) REFERENCES BANK (BANK_ID)
);

CREATE INDEX BANK_BRANCH_IND1 ON BANK_BRANCH (BANK_ID);



CREATE TABLE ACCOUNT_MASTER (
  MASTER_ACCOUNT_CODE  VARCHAR(3)   NOT NULL,
  CAPTION              VARCHAR(80)  NOT NULL,
    CONSTRAINT ACCOUNT_MASTER_PK PRIMARY KEY (MASTER_ACCOUNT_CODE)
);



CREATE TABLE ACCOUNT_SCHEMA (
  ACCOUNT_SCHEMA_ID    INTEGER       NOT NULL,
  MASTER_ACCOUNT_CODE  VARCHAR(3)    NOT NULL,
  OWNER_ID             INTEGER       NOT NULL,
  CAPTION              VARCHAR(80)   NOT NULL,
  CODE                 VARCHAR(32)   NOT NULL,
  ACTIVE               CHAR(1)       NOT NULL,
  COST_CENTER          INTEGER,
  DEFAULT_OBJECT_TYPE  CHAR(2),
    CONSTRAINT ACCOUNT_SCHEMA_PK PRIMARY KEY (ACCOUNT_SCHEMA_ID),
    CONSTRAINT ACCOUNT_SCHEMAS FOREIGN KEY (MASTER_ACCOUNT_CODE) REFERENCES ACCOUNT_MASTER (MASTER_ACCOUNT_CODE)
);


CREATE INDEX ACCOUNT_SCHEMA_IND1 ON ACCOUNT_SCHEMA (MASTER_ACCOUNT_CODE);
CREATE INDEX ACCOUNT_SCHEMA_IND2 ON ACCOUNT_SCHEMA (OWNER_ID);



CREATE TABLE BANK_ACCOUNT (
  IBAN                 VARCHAR(22)   NOT NULL,
  SWIFT                VARCHAR(11)   NOT NULL,
  OWNER_ID             INTEGER       NOT NULL,
  CURRENCY             CHAR(3)       NOT NULL,
  ACCOUNT_NO           VARCHAR(40),
  ACCOUNT_TYPE         CHAR(1),
  BALANCE              DECIMAL(12,2),
  CREDIT_LIMIT         DECIMAL(12,2),
    CONSTRAINT BANK_ACCOUNT_PK PRIMARY KEY (IBAN),
    CONSTRAINT BANK_ACCOUNTS FOREIGN KEY (SWIFT) REFERENCES BANK_BRANCH (SWIFT)
);


CREATE INDEX BANK_ACCOUNT_IND1 ON BANK_ACCOUNT (SWIFT);
CREATE INDEX BANK_ACCOUNT_IND2 ON BANK_ACCOUNT (OWNER_ID);



CREATE TABLE ACCOUNT_BALANCE (
  ACCOUNT_SCHEMA_ID    INTEGER         NOT NULL,
  CURRENCY             CHAR(3)         NOT NULL,
  REF_DATE             TIMESTAMP       NOT NULL,
  REF_YEAR             SMALLINT        NOT NULL,
  REF_QUARTER          SMALLINT        NOT NULL,
  REF_MONTH            SMALLINT        NOT NULL,
  REF_DAY              SMALLINT        NOT NULL,
  REF_WEEK             SMALLINT        NOT NULL,
  DEBIT                DECIMAL(12,2)   NOT NULL,
  CREDIT               DECIMAL(12,2),
    CONSTRAINT ACCOUNT_BALANCE_PK PRIMARY KEY (ACCOUNT_SCHEMA_ID,CURRENCY,REF_DATE),
    CONSTRAINT ACCOUNT_BALANCES FOREIGN KEY (ACCOUNT_SCHEMA_ID) REFERENCES ACCOUNT_SCHEMA (ACCOUNT_SCHEMA_ID)
);



CREATE TABLE ACCOUNT_TRANSACTION_TEMPLATE (
  TEMPLATE_ID          INTEGER       NOT NULL,
  OWNER_ID             INTEGER       NOT NULL,
  CAPTION              VARCHAR(30)   NOT NULL,
  DOCUMENT_TYPE        CHAR(2)       NOT NULL,
    CONSTRAINT ACCOUNT_TRANSACTION_TEMPLATE_PK PRIMARY KEY (TEMPLATE_ID)
);

CREATE INDEX ACCOUNT_TRANSACTION_TEMPLATE_IND1 ON ACCOUNT_TRANSACTION_TEMPLATE (OWNER_ID);



CREATE TABLE ACCOUNT_TX_TEMPLATE_ITEM (
  TEMPLATE_ID          INTEGER   NOT NULL,
  ACCOUNT_SCHEMA_ID    INTEGER   NOT NULL,
  DEBIT_CREDIT         CHAR(1)   NOT NULL,
  OBJECT_TYPE          CHAR(2),
    CONSTRAINT ACCOUNT_TX_TEMPLATE_ITEM_PK   PRIMARY KEY (TEMPLATE_ID,ACCOUNT_SCHEMA_ID),
    CONSTRAINT ACCOUNT_TX_TEMPLATE_ITEMS     FOREIGN KEY (TEMPLATE_ID)       REFERENCES ACCOUNT_TRANSACTION_TEMPLATE (TEMPLATE_ID) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT ACCOUNT_SCHEMA_TEMPLATE_ITEMS FOREIGN KEY (ACCOUNT_SCHEMA_ID) REFERENCES ACCOUNT_SCHEMA (ACCOUNT_SCHEMA_ID)
);

CREATE INDEX ACCOUNT_TX_TEMPLATE_ITEM_IND1 ON ACCOUNT_TX_TEMPLATE_ITEM (ACCOUNT_SCHEMA_ID);



CREATE TABLE ACCOUNT_TRANSACTION (
  TRANSACTION_ID       BIGINT     NOT NULL,
  OWNER_ID             INTEGER    NOT NULL,
  CURRENCY             CHAR(2)    NOT NULL,
  TX_TIMESTAMP         TIMESTAMP  NOT NULL,
  TX_YEAR              SMALLINT   NOT NULL,
  TX_QUARTER           SMALLINT   NOT NULL,
  TX_MONTH             SMALLINT   NOT NULL,
  TX_WEEK              SMALLINT   NOT NULL,
  TX_DAY               SMALLINT   NOT NULL,
  DOCUMENT_TYPE        CHAR(2),
  DOCUMENT_ID          INTEGER,
  REVERSE_TRANSACTION  BIGINT,
  DESCRIPTION          VARCHAR(200),
    CONSTRAINT ACCOUNT_TRANSACTION_PK PRIMARY KEY (TRANSACTION_ID)
);

CREATE INDEX ACCOUNT_TRANSACTION_IND1 ON ACCOUNT_TRANSACTION (OWNER_ID);


CREATE TABLE ACCOUNT_TRANSACTION_ITEM (
  TRANSACTION_ID       BIGINT          NOT NULL,
  ACCOUNT_SCHEMA_ID    INTEGER         NOT NULL,
  DEBIT                DECIMAL(12,2)   NOT NULL,
  CREDIT               DECIMAL(12,2)   NOT NULL,
  OBJECT_TYPE          CHAR(2)         NOT NULL,
  OBJECT_ID            INTEGER         NOT NULL,
    CONSTRAINT ACCOUNT_TRANSACTION_ITEM_PK PRIMARY KEY (TRANSACTION_ID,ACCOUNT_SCHEMA_ID),
    CONSTRAINT ACCOUNT_TRANSACTION_ITEMS   FOREIGN KEY (TRANSACTION_ID)    REFERENCES ACCOUNT_TRANSACTION (TRANSACTION_ID) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT ACCOUNT_SCHEMA_TRANSACTIONS FOREIGN KEY (ACCOUNT_SCHEMA_ID) REFERENCES ACCOUNT_SCHEMA (ACCOUNT_SCHEMA_ID)
);

CREATE INDEX ACCOUNT_TRANSACTION_ITEM_IND1 ON ACCOUNT_TRANSACTION_ITEM (ACCOUNT_SCHEMA_ID);
