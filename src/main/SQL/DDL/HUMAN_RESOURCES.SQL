CREATE TABLE PERSON (
  PERSON_ID            INTEGER        NOT NULL,
  FIRST_NAME           VARCHAR (40)   NOT NULL,
  MIDDLE_NAME          VARCHAR (40),
  LAST_NAME            VARCHAR (40)   NOT NULL,
  BIRTHDAY             TIMESTAMP      NOT NULL,
  GENDER               CHAR (1)       NOT NULL,
  NATIONALITY          CHAR (2)       NOT NULL,
  GOVERNMENT_ID        VARCHAR (20),
  PERSONAL_MAIL        VARCHAR (80),
  CELL_PHONE           VARCHAR (20),
    CONSTRAINT PERSON_PK PRIMARY KEY (PERSON_ID)
);



CREATE TABLE CREDIT_CARD (
  CARD_NUMBER          CHAR(24)     NOT NULL,
  CVC2                 VARCHAR(3)   NOT NULL,
  EXPIRE_YEAR          SMALLINT     NOT NULL,
  EXPIRE_MONTH         SMALLINT     NOT NULL,
  NAME_ON_CARD         VARCHAR(80)  NOT NULL,
  PERSON_ID            INTEGER      NOT NULL,
    CONSTRAINT CREDIT_CARD_PK PRIMARY KEY (CARD_NUMBER),
    CONSTRAINT CREDIT_CARDS FOREIGN KEY (PERSON_ID) REFERENCES PERSON (PERSON_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE INDEX CREDIT_CARD_IND1 ON CREDIT_CARD (PERSON_ID);



CREATE TABLE QUALIFICATION (
  QUALIFICATION_ID     INTEGER          NOT NULL,
  QUALIFICATION_TYPE   VARCHAR (12)     NOT NULL,
  CAPTION              VARCHAR (80)     NOT NULL,
  GRADE_BASE           DECIMAL (10,2)   NOT NULL,
  VALIDITY             INTEGER,
    CONSTRAINT QUALIFICATION_PK PRIMARY KEY (QUALIFICATION_ID)
);



CREATE TABLE USER_ACCOUNT_OWNER (
  USERNAME             VARCHAR (30)   NOT NULL,
  PERSON_ID            INTEGER        NOT NULL,
  BEGDA                TIMESTAMP      NOT NULL,
    CONSTRAINT USER_ACCOUNT_OWNER_PK PRIMARY KEY (USERNAME, PERSON_ID, BEGDA),
    CONSTRAINT USER_ACCOUNTS_OWNERS  FOREIGN KEY (USERNAME)  REFERENCES USER_ACCOUNT (USERNAME),
    CONSTRAINT PERSONS_USER_ACCOUNTS FOREIGN KEY (PERSON_ID) REFERENCES PERSON (PERSON_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE INDEX USER_ACCOUNT_OWNER_IND1 ON USER_ACCOUNT_OWNER (PERSON_ID);



CREATE TABLE ORGANIZATION (
  ORGANIZATION_ID      INTEGER        NOT NULL,
  OWNER_ID             INTEGER        NOT NULL,
  ORGANIZATION_TYPE    CHAR (2)       NOT NULL,
  ADDRESS_ID           SMALLINT       NOT NULL,
  CAPTION              VARCHAR (80)   NOT NULL,
  PARENT_ID            INTEGER,
    CONSTRAINT ORGANIZATION_PK       PRIMARY KEY (ORGANIZATION_ID),
    CONSTRAINT CHILD_ORGANIZATIONS   FOREIGN KEY (PARENT_ID) REFERENCES ORGANIZATION (ORGANIZATION_ID),
    CONSTRAINT ADDRESS_ORGANIZATIONS FOREIGN KEY (OWNER_ID, ADDRESS_ID) REFERENCES PARTNER_ADDRESS (BUSINESS_PARTNER_ID, ADDRESS_ID)
);

CREATE INDEX ORGANIZATION_IND1 ON ORGANIZATION (PARENT_ID);
CREATE INDEX ORGANIZATION_IND2 ON ORGANIZATION (OWNER_ID, ADDRESS_ID);



CREATE TABLE EMPLOYEE (
  PERSON_ID            INTEGER       NOT NULL,
  EMPLOYMENT           TIMESTAMP     NOT NULL,
  OWNER_ID             INTEGER       NOT NULL,
  POSITION             VARCHAR (20),
  EMAIL_ADDRESS        VARCHAR (80),
  WORK_PHONE           VARCHAR (20),
  CELL_PHONE           VARCHAR (20),
  DEPARTURE            TIMESTAMP,
  DEPARTURE_TYPE       CHAR (1),
    CONSTRAINT EMPLOYEE_PK         PRIMARY KEY (PERSON_ID, EMPLOYMENT),
    CONSTRAINT PERSONS_EMPLOYMENTS FOREIGN KEY (PERSON_ID) REFERENCES PERSON (PERSON_ID)
);

CREATE INDEX BUSINESS_EMPLOYEE_IND1 ON EMPLOYEE (OWNER_ID);



CREATE TABLE PERSON_QUALIFICATION (
  PERSON_ID            INTEGER         NOT NULL,
  QUALIFICATION_ID     INTEGER         NOT NULL,
  BEGDA                TIMESTAMP       NOT NULL,
  ENDDA                TIMESTAMP,
  GRADE                DECIMAL (10,2),
  ISSUER               VARCHAR (80),
  DEPARTMENT           VARCHAR (80),
    CONSTRAINT PERSON_QUALIFICATION_PK PRIMARY KEY (PERSON_ID, QUALIFICATION_ID, BEGDA),
    CONSTRAINT PERSON_QUALIFICATIONS   FOREIGN KEY (PERSON_ID) REFERENCES PERSON (PERSON_ID) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT QUALIFIED_PERSONNEL     FOREIGN KEY (QUALIFICATION_ID) REFERENCES QUALIFICATION (QUALIFICATION_ID)
);

CREATE INDEX PERSON_QUALIFICATION_IND1 ON PERSON_QUALIFICATION (QUALIFICATION_ID);



CREATE TABLE POSITION_TYPE (
  OWNER_ID             INTEGER        NOT NULL,
  POSITION             VARCHAR (20)   NOT NULL,
  CAPTION              VARCHAR (80)   NOT NULL,
    CONSTRAINT POSITION_TYPE_PK PRIMARY KEY (OWNER_ID, POSITION)
);



CREATE TABLE POSITION (
  OWNER_ID             INTEGER        NOT NULL,
  ORGANIZATION_ID      INTEGER        NOT NULL,
  POSITION             VARCHAR (20)   NOT NULL,
  BEGDA                TIMESTAMP      NOT NULL,
  ENDDA                TIMESTAMP      NOT NULL,
    CONSTRAINT POSITION_PK    PRIMARY KEY (OWNER_ID, ORGANIZATION_ID, POSITION),
    CONSTRAINT POSITIONS      FOREIGN KEY (ORGANIZATION_ID)    REFERENCES ORGANIZATION (ORGANIZATION_ID) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT TYPE_POSITIONS FOREIGN KEY (OWNER_ID, POSITION) REFERENCES POSITION_TYPE (OWNER_ID, POSITION)
);

CREATE INDEX POSITION_IND1 ON POSITION (ORGANIZATION_ID);
CREATE INDEX POSITION_IND2 ON POSITION (OWNER_ID, POSITION);



CREATE TABLE POSITION_QUALIFICATION (
  OWNER_ID             INTEGER          NOT NULL,
  ORGANIZATION_ID      INTEGER          NOT NULL,
  POSITION             VARCHAR (20)     NOT NULL,
  QUALIFICATION_ID     INTEGER          NOT NULL,
  GRADE                DECIMAL (10,2)   NOT NULL,
  PRIORITY             CHAR (1)         NOT NULL,
  IMPACT_PERCENT       SMALLINT         NOT NULL,
    CONSTRAINT POSITION_QUALIFICATION_PK PRIMARY KEY (OWNER_ID, ORGANIZATION_ID, POSITION, QUALIFICATION_ID),
    CONSTRAINT QUALIFIED_POSITIONS       FOREIGN KEY (QUALIFICATION_ID)                    REFERENCES QUALIFICATION (QUALIFICATION_ID),
    CONSTRAINT REQUIRED_QUALIFICATIONS   FOREIGN KEY (OWNER_ID, ORGANIZATION_ID, POSITION) REFERENCES POSITION (OWNER_ID, ORGANIZATION_ID, POSITION) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE INDEX POSITION_QUALIFICATION_IND1 ON POSITION_QUALIFICATION (QUALIFICATION_ID);



CREATE TABLE POSITION_ASSIGNMENT (
  OWNER_ID             INTEGER        NOT NULL,
  ORGANIZATION_ID      INTEGER        NOT NULL,
  POSITION             VARCHAR (20)   NOT NULL,
  PERSON_ID            INTEGER        NOT NULL,
  EMPLOYMENT           TIMESTAMP      NOT NULL,
  BEGDA                TIMESTAMP      NOT NULL,
  ENDDA                TIMESTAMP,
  REASON               CHAR (1)       NOT NULL,
  ASSIGNMENT_TYPE      CHAR (1)       NOT NULL,
    CONSTRAINT POSITION_ASSIGNMENT_PK PRIMARY KEY (OWNER_ID, ORGANIZATION_ID, POSITION, PERSON_ID, EMPLOYMENT, BEGDA),
    CONSTRAINT ASSIGNED_PERSONNEL     FOREIGN KEY (OWNER_ID, ORGANIZATION_ID, POSITION) REFERENCES POSITION (OWNER_ID, ORGANIZATION_ID, POSITION),
    CONSTRAINT POSITION_ASSIGNMENTS   FOREIGN KEY (PERSON_ID, EMPLOYMENT)               REFERENCES EMPLOYEE (PERSON_ID, EMPLOYMENT) ON DELETE CASCADE ON UPDATE CASCADE
);


CREATE INDEX POSITION_ASSIGNMENT_IND1 ON POSITION_ASSIGNMENT (PERSON_ID, EMPLOYMENT);
