CREATE TABLE SHIPMENT (
  SHIPMENT_ID          INTEGER         NOT NULL,
  OWNER_ID             INTEGER         NOT NULL,
  SHIPMENT_TYPE        CHAR(1)         NOT NULL,
  SHIP_DATE            TIMESTAMP       NOT NULL,
  STATUS               CHAR(1)         NOT NULL,
  ORGANIZATION_ID      INTEGER         NOT NULL,
  USERNAME             VARCHAR(30)     NOT NULL,
  COST                 DECIMAL(10,2),
  INVOICE_ID           VARCHAR(20),
  FROM_ADDRESS         VARCHAR(80),
  FROM_CITY            VARCHAR(20),
  FROM_STATE           VARCHAR(2),
  FROM_COUNTRY         VARCHAR(2),
  TO_ADDRESS           VARCHAR(80)     NOT NULL,
  TO_CITY              VARCHAR(20)     NOT NULL,
  TO_STATE             VARCHAR(2),
  TO_COUNTRY           VARCHAR(2),
    CONSTRAINT SHIPMENT_PK PRIMARY KEY (SHIPMENT_ID),
    CONSTRAINT SHIPMENTS FOREIGN KEY (ORGANIZATION_ID)
      REFERENCES ORGANIZATION (ORGANIZATION_ID)
);

CREATE INDEX SHIPMENT_IND1 ON SHIPMENT (OWNER_ID);


CREATE TABLE SHIPMENT_LINE (
  SHIPMENT_ID          INTEGER         NOT NULL,
  SHIPMENT_LINE        SMALLINT        NOT NULL,
  MATERIAL_ID          INTEGER         NOT NULL,
  QUANTITY             DECIMAL(10,2)   NOT NULL,
  UNIT                 VARCHAR(2)      NOT NULL,
  REF_ORDER_TYPE CHAR(1),
  REF_ORDER_ID INTEGER,
    CONSTRAINT SHIPMENT_LINE_PK   PRIMARY KEY (SHIPMENT_ID, SHIPMENT_LINE),
    CONSTRAINT SHIPMENT_LINES     FOREIGN KEY (SHIPMENT_ID) REFERENCES SHIPMENT (SHIPMENT_ID) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT MATERIAL_SHIPMENTS FOREIGN KEY (MATERIAL_ID) REFERENCES MATERIAL (MATERIAL_ID)
);

CREATE INDEX SHIPMENT_LINES_IND3 ON SHIPMENT_LINE (MATERIAL_ID);



CREATE TABLE MATERIAL_REQUEST (
  MATERIAL_REQUEST_ID  INTEGER       NOT NULL,
  OWNER_ID             INTEGER       NOT NULL,
  ORGANIZATION_ID      INTEGER       NOT NULL,
  USERNAME             VARCHAR(30)   NOT NULL,
  PURPOSE              CHAR(1)       NOT NULL,
  REQUEST_DATE         TIMESTAMP     NOT NULL,
  DUE_DATE             TIMESTAMP     NOT NULL,
  STATUS               CHAR(1)       NOT NULL,
  DESCRIPTION          VARCHAR(250),
    CONSTRAINT MATERIAL_REQUEST_PK PRIMARY KEY(MATERIAL_REQUEST_ID),
    CONSTRAINT MATERIAL_REQUESTS FOREIGN KEY(ORGANIZATION_ID) REFERENCES ORGANIZATION(ORGANIZATION_ID)
);


CREATE INDEX MATERIAL_REQUEST_IND1 ON MATERIAL_REQUEST (ORGANIZATION_ID);
CREATE INDEX MATERIAL_REQUEST_IND2 ON MATERIAL_REQUEST (OWNER_ID);


CREATE TABLE MATERIAL_REQUEST_ITEM (
  MATERIAL_REQUEST_ID  INTEGER         NOT NULL,
  LINE                 SMALLINT        NOT NULL,
  MATERIAL_ID          INTEGER         NOT NULL,
  QUANTITY             DECIMAL(10,2)   NOT NULL,
  UNIT                 VARCHAR(3)      NOT NULL,
  DESCRIPTION          VARCHAR(250),
    CONSTRAINT MATERIAL_REQUEST_ITEM_PK PRIMARY KEY(MATERIAL_REQUEST_ID, LINE),
    CONSTRAINT MATERIAL_REQUEST_ITEMS   FOREIGN KEY(MATERIAL_REQUEST_ID) REFERENCES MATERIAL_REQUEST(MATERIAL_REQUEST_ID) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT MATERIALS_REQUESTS       FOREIGN KEY(MATERIAL_ID)         REFERENCES MATERIAL(MATERIAL_ID)
);

CREATE INDEX MATERIAL_REQUEST_ITEM_IND1 ON MATERIAL_REQUEST_ITEM (MATERIAL_ID);



CREATE TABLE MATERIAL_REQUEST_ITEM_ATTR (
  MATERIAL_REQUEST_ID  INTEGER      NOT NULL,
  LINE                 SMALLINT     NOT NULL,
  MAG_ID               VARCHAR(8)   NOT NULL,
  VALUE                VARCHAR(8)   NOT NULL,
    CONSTRAINT MATERIAL_REQUEST_ITEM_ATTR_PK PRIMARY KEY(MATERIAL_REQUEST_ID, LINE, MAG_ID),
    CONSTRAINT MATERIAL_REQUEST_ITEM_ATTRS   FOREIGN KEY(MATERIAL_REQUEST_ID, LINE) REFERENCES MATERIAL_REQUEST_ITEM(MATERIAL_REQUEST_ID, LINE) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT ATTR_GROUP_MATERIAL_REQUESTS  FOREIGN KEY(MAG_ID)                    REFERENCES MATERIAL_ATTRIBUTE_GROUP(MAG_ID)
);

CREATE INDEX MATERIAL_REQUEST_ITEM_ATTR_IND1 ON MATERIAL_REQUEST_ITEM_ATTR (MAG_ID);



CREATE TABLE PRODUCT_TYPE_BY_DEFINE (
  MATERIAL_TYPE_ID     VARCHAR(30)   NOT NULL,
  ORGANIZATION_ID      INTEGER       NOT NULL,
  LEAD_TIME            SMALLINT      NOT NULL,
  TIME_TYPE            CHAR(1)       NOT NULL,
    CONSTRAINT PRODUCT_TYPE_BY_DEFINE_PK PRIMARY KEY(MATERIAL_TYPE_ID, ORGANIZATION_ID),
    CONSTRAINT MATERIAL_TYPE_BY_DEFINE   FOREIGN KEY(MATERIAL_TYPE_ID) REFERENCES MATERIAL_TYPE (MATERIAL_TYPE_ID),
    CONSTRAINT PRODUCT_TYPE_BY_DEFINES   FOREIGN KEY(ORGANIZATION_ID)  REFERENCES ORGANIZATION(ORGANIZATION_ID)
);

CREATE INDEX PRODUCT_TYPE_BY_DEFINE_IND1 ON PRODUCT_TYPE_BY_DEFINE (ORGANIZATION_ID);



CREATE TABLE PRODUCT_BY_DEFINE (
  MATERIAL_TYPE_ID     VARCHAR(30)   NOT NULL,
  ORGANIZATION_ID      INTEGER       NOT NULL,
  MATERIAL_ID          INTEGER       NOT NULL,
  CONTENT_REQUIRED     CHAR(1)       NOT NULL,
    CONSTRAINT PRODUCT_BY_DEFINE_PK PRIMARY KEY(MATERIAL_TYPE_ID, ORGANIZATION_ID, MATERIAL_ID),
    CONSTRAINT PRODUCT_BY_DEFINES   FOREIGN KEY(MATERIAL_TYPE_ID, ORGANIZATION_ID) REFERENCES PRODUCT_TYPE_BY_DEFINE(MATERIAL_TYPE_ID, ORGANIZATION_ID),
    CONSTRAINT MATERIAL_BY_DEFINES  FOREIGN KEY(MATERIAL_ID)                       REFERENCES MATERIAL(MATERIAL_ID)
);

CREATE INDEX PRODUCT_BY_DEFINE_IND1 ON PRODUCT_BY_DEFINE (MATERIAL_ID);
